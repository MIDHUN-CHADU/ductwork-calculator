<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Duct Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .form-group { margin: 15px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; margin: 5px 0; }
        button { padding: 15px 30px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .reset-btn { background: #dc3545; }
        .reset-btn:hover { background: #c82333; }
        .results { background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Simple Duct Calculator Test</h1>
    
    <form id="ductForm">
        <div class="form-group">
            <label for="airflow">Airflow (CFM):</label>
            <input type="number" id="airflow" placeholder="Enter CFM" required>
        </div>
        
        <div class="form-group">
            <label for="velocityClass">Velocity Classification:</label>
            <select id="velocityClass" required>
                <option value="">Select Velocity Class</option>
                <option value="quiet">Quiet (Class I) - 800 FPM Max</option>
                <option value="standard">Standard (Class II) - 1000 FPM Max</option>
                <option value="economy">Economy (Class III) - 1200 FPM Max</option>
                <option value="loud">Loud (Class IV) - 1800 FPM Max</option>
                <option value="low-pressure">Low-Pressure System - 2500 FPM Max</option>
                <option value="medium-pressure">Medium-Pressure System - 3500 FPM Max</option>
                <option value="high-pressure">High-Pressure System - 6000 FPM Max</option>
                <option value="custom">Custom Velocity</option>
            </select>
        </div>
        
        <div class="form-group hidden" id="customVelocityGroup">
            <label for="velocity">Custom Velocity (FPM):</label>
            <input type="number" id="velocity" placeholder="Enter custom FPM" required>
        </div>
        
        <div class="form-group">
            <label for="ductClass">Duct Classification:</label>
            <select id="ductClass" required>
                <option value="">Select Duct Class</option>
                <option value="supply-main">Supply - Main Trunk</option>
                <option value="supply-branch">Supply - Branch</option>
                <option value="return-main">Return - Main</option>
                <option value="return-branch">Return - Branch</option>
                <option value="exhaust">Exhaust Duct</option>
                <option value="outside-air">Outside Air Duct</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Duct Shape:</label>
            <select id="ductShape">
                <option value="rectangular">Rectangular</option>
                <option value="circular">Circular</option>
            </select>
        </div>
        
        <div class="form-group" id="rectangularOptions">
            <label>Rectangular Method:</label>
            <select id="rectangularMethod">
                <option value="">Select Method</option>
                <option value="auto">Auto Size (Square)</option>
                <option value="fixed-height">Fixed Height</option>
            </select>
        </div>
        
        <div class="form-group hidden" id="fixedHeightGroup">
            <label for="fixedHeight">Fixed Height (inches):</label>
            <input type="number" id="fixedHeight" placeholder="Enter height" min="4" max="72">
        </div>
        
        <div class="form-group">
            <label for="insulation">Insulation Thickness (inches):</label>
            <select id="insulation">
                <option value="0">No Insulation</option>
                <option value="1">1 inch</option>
                <option value="2" selected>2 inches</option>
                <option value="3">3 inches</option>
            </select>
        </div>
        
        <button type="submit">Calculate</button>
        <button type="button" class="reset-btn" onclick="resetForm()">Reset</button>
    </form>
    
    <div id="results" class="results hidden">
        <h2>Results:</h2>
        <div id="resultContent"></div>
    </div>

    <script>
        // Show/hide options based on selections
        document.getElementById('ductShape').addEventListener('change', function() {
            const rectangularOptions = document.getElementById('rectangularOptions');
            const fixedHeightGroup = document.getElementById('fixedHeightGroup');
            
            if (this.value === 'rectangular') {
                rectangularOptions.style.display = 'block';
            } else {
                rectangularOptions.style.display = 'none';
                fixedHeightGroup.classList.add('hidden');
            }
        });

        document.getElementById('rectangularMethod').addEventListener('change', function() {
            const fixedHeightGroup = document.getElementById('fixedHeightGroup');
            
            if (this.value === 'fixed-height') {
                fixedHeightGroup.classList.remove('hidden');
            } else {
                fixedHeightGroup.classList.add('hidden');
            }
        });
        
        // Velocity class selection
        document.getElementById('velocityClass').addEventListener('change', function() {
            const customVelocityGroup = document.getElementById('customVelocityGroup');
            
            if (this.value === 'custom') {
                customVelocityGroup.classList.remove('hidden');
            } else {
                customVelocityGroup.classList.add('hidden');
                document.getElementById('velocity').value = '';
            }
        });

        // Form submission
        document.getElementById('ductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const airflow = parseFloat(document.getElementById('airflow').value);
            const velocityClass = document.getElementById('velocityClass').value;
            const ductClass = document.getElementById('ductClass').value;
            const shape = document.getElementById('ductShape').value;
            const insulation = parseFloat(document.getElementById('insulation').value);
            
            // Get velocity based on classification
            let velocity;
            if (velocityClass === 'custom') {
                velocity = parseFloat(document.getElementById('velocity').value);
                if (!velocity) {
                    alert('Please enter a custom velocity value');
                    return;
                }
            } else {
                const velocityLimits = {
                    'quiet': 800,
                    'standard': 1000,
                    'economy': 1200,
                    'loud': 1800,
                    'low-pressure': 2500,
                    'medium-pressure': 3500,
                    'high-pressure': 6000
                };
                velocity = velocityLimits[velocityClass];
            }
            
            if (!airflow || !velocity || !velocityClass || !ductClass) {
                alert('Please fill in all required fields');
                return;
            }
            
            let results = calculateDuct(airflow, velocity, velocityClass, ductClass, shape, insulation);
            displayResults(results);
        });

        function calculateDuct(airflow, velocity, velocityClass, ductClass, shape, insulation) {
            const area = airflow / velocity; // sq ft
            
            if (shape === 'rectangular') {
                const method = document.getElementById('rectangularMethod').value;
                
                if (!method) {
                    alert('Please select a rectangular sizing method');
                    return null;
                }
                
                if (method === 'fixed-height') {
                    const fixedHeight = parseFloat(document.getElementById('fixedHeight').value);
                    if (!fixedHeight) {
                        alert('Please enter a fixed height');
                        return null;
                    }
                    
                    const width = (area * 144) / fixedHeight; // inches
                    const standardWidth = roundToStandard(width);
                    
                    return {
                        shape: 'rectangular',
                        width: standardWidth,
                        height: fixedHeight,
                        overallWidth: standardWidth + (2 * insulation),
                        overallHeight: fixedHeight + (2 * insulation),
                        area: (standardWidth * fixedHeight) / 144,
                        actualVelocity: airflow / ((standardWidth * fixedHeight) / 144),
                        method: 'Fixed Height',
                        velocityClass: getVelocityClassName(velocityClass),
                        ductClass: ductClass,
                        insulation: insulation
                    };
                } else {
                    // Auto size - make square
                    const side = Math.sqrt(area * 144); // inches
                    const width = roundToStandard(side);
                    const height = roundToStandard(side);
                    
                    return {
                        shape: 'rectangular',
                        width: width,
                        height: height,
                        overallWidth: width + (2 * insulation),
                        overallHeight: height + (2 * insulation),
                        area: (width * height) / 144,
                        actualVelocity: airflow / ((width * height) / 144),
                        method: 'Auto Size (Square)',
                        velocityClass: getVelocityClassName(velocityClass),
                        ductClass: ductClass,
                        insulation: insulation
                    };
                }
            } else {
                // Circular
                const diameter = Math.sqrt((4 * area) / Math.PI) * 12; // inches
                const standardDiameter = roundToStandardCircular(diameter);
                
                return {
                    shape: 'circular',
                    diameter: standardDiameter,
                    overallDiameter: standardDiameter + (2 * insulation),
                    area: Math.PI * Math.pow(standardDiameter / 12, 2) / 4,
                    actualVelocity: airflow / (Math.PI * Math.pow(standardDiameter / 12, 2) / 4),
                    velocityClass: getVelocityClassName(velocityClass),
                    ductClass: ductClass,
                    insulation: insulation
                };
            }
        }
        
        function getVelocityClassName(velocityClass) {
            const names = {
                'quiet': 'Quiet (Class I)',
                'standard': 'Standard (Class II)',
                'economy': 'Economy (Class III)',
                'loud': 'Loud (Class IV)',
                'low-pressure': 'Low-Pressure',
                'medium-pressure': 'Medium-Pressure',
                'high-pressure': 'High-Pressure',
                'custom': 'Custom'
            };
            return names[velocityClass] || velocityClass;
        }

        function roundToStandard(size) {
            const standards = [6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 40, 44, 48];
            return standards.reduce((prev, curr) => 
                Math.abs(curr - size) < Math.abs(prev - size) ? curr : prev
            );
        }

        function roundToStandardCircular(size) {
            const standards = [4, 5, 6, 7, 8, 9, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36];
            return standards.reduce((prev, curr) => 
                Math.abs(curr - size) < Math.abs(prev - size) ? curr : prev
            );
        }

        function displayResults(results) {
            if (!results) return;
            
            const resultsDiv = document.getElementById('results');
            const content = document.getElementById('resultContent');
            
            let html = '';
            
            if (results.shape === 'rectangular') {
                html = `
                    <p><strong>Method:</strong> ${results.method}</p>
                    <p><strong>Bare Duct:</strong> ${results.width}" × ${results.height}"</p>
                    <p><strong>Overall (w/ insulation):</strong> ${results.overallWidth}" × ${results.overallHeight}"</p>
                `;
            } else {
                html = `
                    <p><strong>Bare Diameter:</strong> ${results.diameter}"</p>
                    <p><strong>Overall Diameter:</strong> ${results.overallDiameter}"</p>
                `;
            }
            
            html += `
                <p><strong>Insulation:</strong> ${results.insulation}" thick</p>
                <p><strong>Area:</strong> ${results.area.toFixed(2)} sq ft</p>
                <p><strong>Actual Velocity:</strong> ${Math.round(results.actualVelocity)} FPM</p>
                <p><strong>Velocity Class:</strong> ${results.velocityClass}</p>
                <p><strong>Duct Class:</strong> ${results.ductClass}</p>
            `;
            
            content.innerHTML = html;
            resultsDiv.classList.remove('hidden');
        }

        function resetForm() {
            document.getElementById('ductForm').reset();
            document.getElementById('results').classList.add('hidden');
            document.getElementById('fixedHeightGroup').classList.add('hidden');
            document.getElementById('customVelocityGroup').classList.add('hidden');
            document.getElementById('insulation').value = '2'; // Reset to default
        }
    </script>
</body>
</html>
